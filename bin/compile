#!/usr/bin/env bash
echo "------> Installing Mysql 5.1"
BUILD_DIR=$1
BUILD_PATH=$(cd $1 && pwd)
CACHE_DIR=$2
ENV_DIR=$3
PROFILE=${BUILD_PATH}/.profile.d
bpdir=$(cd $(dirname $(dirname $0)); pwd)

cd $BUILD_DIR
# download the minimal mysql tar file
echo "------> Downloading minimized tarball"
wget https://raw.githubusercontent.com/gaumire/mysql-binary/master/mysql.tar.gz
# make a directory to untar (like unzip) the binary
mkdir -p $BUILD_DIR/.heroku/vendor/mysql
# untar the binary to a directory inside /app/.heroku
tar -C $BUILD_DIR/.heroku/vendor/mysql -xvf mysql.tar.gz
# remove the tar file
rm -f mysql.tar.gz

mkdir -p ${PROFILE}
touch ${PROFILE}/mysql_buildpack_paths.sh
echo "export PATH=/app/.heroku/vendor/mysql/bin" >> $build_path/.profile.d/mysql_buildpack_paths.sh
